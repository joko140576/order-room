<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Order Meeting Room - PT SSI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">
  <h4 class="text-center mb-4">Form Pemesanan Ruang Rapat</h4>
  
  <form id="orderForm" class="card p-3 shadow-sm">
    <div class="mb-3">
      <label class="form-label">Nama Pemesan</label>
      <input type="text" class="form-control" name="nama" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Divisi / Unit</label>
      <input type="text" class="form-control" name="divisi" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Ruang</label>
      <select class="form-select" name="ruang" required>
        <option value="">Pilih Ruang</option>
        <option>Ruang Lt 3 - Marotai</option>
        <option>Ruang Lt 3 - Natuna</option>
        <option>Ruang Lt 2</option>
        <option>Ruang Lt 1 - Rote</option>
      </select>
    </div>
    <div class="row">
      <div class="col-6 mb-3">
        <label class="form-label">Jam Mulai</label>
        <input type="time" class="form-control" name="jamMulai" required>
      </div>
      <div class="col-6 mb-3">
        <label class="form-label">Jam Akhir</label>
        <input type="time" class="form-control" name="jamAkhir" required>
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Acara</label>
      <textarea class="form-control" name="acara" rows="2" required></textarea>
    </div>

    <button type="submit" class="btn btn-success w-100 mb-2">Pesan</button>
    <button type="button" class="btn btn-outline-primary w-100" id="lihatData">Lihat Data</button>
  </form>

  <div id="dataTable" class="mt-4 d-none">
    <h5 class="mb-3 text-center">20 Jadwal Terbaru</h5>
    <div class="table-responsive">
      <table class="table table-bordered table-striped small text-center">
        <thead class="table-light">
          <tr>
            <th>Waktu</th>
            <th>Nama</th>
            <th>Divisi</th>
            <th>Ruang</th>
            <th>Mulai</th>
            <th>Akhir</th>
            <th>Acara</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="responseModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <p id="modalMessage"></p>
        <button class="btn btn-primary" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycby8fr5S5k4WQDe_u06qzBfNGdPeI_hRpvQM9PuvcTQEI9gDx22sntUOlcqRbOMfSHxYiA/exec"; // GANTI DENGAN URL WEB APP KAMU

document.getElementById("orderForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const form = e.target;
  const data = Object.fromEntries(new FormData(form).entries());

  try {
    const res = await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    const result = await res.json();
    if (result.result === "success") {
      document.getElementById("modalMessage").textContent =
        "Data sudah tersimpan! Klik 'Lihat Data' untuk memastikan tidak bentrok.";
      new bootstrap.Modal(document.getElementById("responseModal")).show();
      form.reset();
    } else {
      alert("Gagal menyimpan data: " + result.message);
    }
  } catch (err) {
    alert("Terjadi kesalahan koneksi: " + err);
  }
});

document.getElementById("lihatData").addEventListener("click", async () => {
  try {
    const res = await fetch(scriptURL);
    const data = await res.json();

    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";
    data.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.waktu}</td>
        <td>${row.nama}</td>
        <td>${row.divisi}</td>
        <td>${row.ruang}</td>
        <td>${row.jamMulai}</td>
        <td>${row.jamAkhir}</td>
        <td>${row.acara}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("dataTable").classList.remove("d-none");
  } catch (err) {
    alert("Gagal memuat data: " + err);
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
